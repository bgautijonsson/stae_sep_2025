---
title: "Getum við notað tölfræði til að finna hagstæð veðmál í íþróttum?"
subtitle: "Íslenska stærðfræðafélagið"
author:
  - name: Brynjólfur Gauti Guðrúnar Jónsson
institute: "Háskóli Íslands"
format: 
  revealjs:
    theme: theme.scss
    simplemenu:
      flat: false
      barhtml:
        header: "<div class='menubar mb-10'><ul class='menu'></ul><div>"
        footer: "<div class='footer footer-default' style='display: block;'> <a href='https://bggj.is/stae_sep_2025' target='_blank'>bggj.is/stae_sep_2025</a></div>"
html-math-method:
  method: mathjax
  url: "https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"
bibliography: references.bib
csl: cambridge-university-press-numeric.csl
revealjs-plugins:
  - simplemenu
---

## {data-name="Inngangur"}


**Eftirádreifing**
$$
p(\theta | X) \propto p(X | \theta) \cdot p(\theta)
$$  


::: {.fragment}
**Spádreifing:**
$$
p(X_{\text{new}} | X) = \int p(X_{\text{new}} | \theta) \cdot p(\theta | X) \, d\theta
$$
:::

::: {.fragment}
**Líkur á að vinna veðmál:**
$$
P(\text{vinna veðmál}) = P(X_{\text{new}} \in A | X)
$$
:::

## Bradley-Terry og sushi

::: {.columns}
::: {.column width="50%"}
![](images/bradley_terry_sushi.jpeg){fig-align="center"}
:::

::: {.column width="50%"}
::: {.fragment}
$$
\begin{aligned}
P(i > j) &= \frac{e^{\lambda_i}}{e^{\lambda_i} + e^{\lambda_j}}
\end{aligned}
$$
:::

::: {.fragment}
$$
\begin{aligned}
\text{logit}\, P(i > j) &= \lambda_i - \lambda_j
\end{aligned}
$$
:::

::: {.fragment}
$$
\begin{aligned}
P_{\text{ELO}}(i > j) &= \frac{e^{\lambda_i/400}}{e^{\lambda_i/400} + e^{\lambda_j/400}}
\end{aligned}
$$
:::

:::
:::

## {data-name="Líkön"}


![](images/football/data.png){width=100% fig-align="center"}

::: {.fragment}
::: {.columns align="center"}
::: {.column width="50%"}
* Liðsstyrkur er breytilegur
* Fylgni í markafjölda
:::
::: {.column width="50%"}
* Fleiri jafntefli
* Heimavallaráhrif
:::
:::
:::

## 


::: {.columns style="font-size:80%"}

Við höfum $K$ lið, $k \in \{1, \ldots, K\}$ og metum styrk þeirra á tímum $T$, $t \in \{1, \ldots, T\}$.

$$
\begin{gathered}
\text{off}_{k,t} = \text{off}_{k,t-1} + \sigma_{\text{off},k} \sqrt{\Delta ^t_k} \, \epsilon_{k,t}^{\text{off}} \qquad
\text{def}_{k,t} = \text{def}_{k,t-1} + \sigma_{\text{def},k} \sqrt{\Delta ^t_k} \, \epsilon_{k,t}^{\text{def}}
\end{gathered}
$$

:::

::: {.fragment}
![](images/football/evolution_male.png)
:::


##

::: {.columns style="font-size:80%"}

Segjum að lið $i$ spili á heimavelli gegn liði $j$.

$$
\begin{gathered}
\text{off}_{i} = \text{off}_{i,t} + h^\text{off}_{i} \qquad
\text{def}_{i} = \text{def}_{i,t} + h^\text{def}_{i} \\
\text{off}_{j} = \text{off}_{j,t} \qquad
\text{def}_{j} = \text{def}_{j,t}
\end{gathered}
$$

:::

::: {.fragment}
![](images/football/home_advantage.png)
:::

##

::: {.columns style="font-size:80%"}

Látum $\mu_i$ og $\mu_j$ vera væntan fjölda marka liðanna

$$
\begin{gathered}
\log \mu_i = \mu_0 + \text{off}_{i} - \text{def}_{j} \qquad
\log \mu_j = \mu_0 + \text{off}_{j} - \text{def}_{i}
\end{gathered}
$$

::: {.fragment}
Þá gætum við prófað

$$
X_i \sim \text{Poisson}(\mu_i) \qquad
X_j \sim \text{Poisson}(\mu_j)
$$
:::

::: {.fragment}
Ekki endilega nóg af jafnteflum og vantar fylgni milli frammistöðu liðanna
:::

:::

##

::: {.columns style="font-size:80%"}
**Tvívíða Poisson dreifingin**

$$
\begin{gathered}
Z_1 \sim \text{Poisson}(\mu_1) \qquad
Z_2 \sim \text{Poisson}(\mu_2) \qquad
Z_3 \sim \text{Poisson}(\mu_3) 
\end{gathered}
$$

Látum $X_1$ og $X_2$ vera fall af þremur Poisson dreifðum stærðum

$$
\begin{gathered}
X_1 = Z_1 + Z_3 \qquad
X_2 = Z_2 + Z_3
\end{gathered}
$$

Þá vitum við að 

$$
\begin{gathered}
E[X_1] = E[Z_1] + E[Z_3] = \mu_1 + \mu_3 \qquad
E[X_2] = E[Z_2] + E[Z_3] = \mu_2 + \mu_3 
\end{gathered}
$$


$$
\text{Corr}(X_1, X_2) = \frac{\mu_3}{\sqrt{\mu_1 \mu_2}} = \rho
$$

Hvernig viljum við stika þetta?
:::

##

::: {.columns style="font-size:80%"}
Látum $\rho$ vera fall af mismun á styrk liðanna

$$
\text{logit}(\rho) = \alpha_{\rho} + \beta_{\rho}  \cdot \text{diff}
$$

þar sem

$$
\text{diff} = |\text{off}_{i} + \text{def}_{i} - \text{off}_{j} - \text{def}_{j}|
$$

:::

##

::: {.columns style="font-size:80%"}
Látum $\rho$ vera fall af mismun á styrk liðanna

$$
\text{logit}(\rho) = \alpha_{\rho} + \beta_{\rho}  \cdot \text{diff}
$$

þar sem

$$
\text{diff} = |\text{off}_{i} + \text{def}_{i} - \text{off}_{j} - \text{def}_{j}|
$$

:::


![](images/football/fylgni.png){width="100%" fig-align="center"}



##

::: {.columns style="font-size:80%"}
Látum $\rho$ vera fall af mismun á styrk liðanna

$$
\text{logit}(\rho) = \alpha_{\rho} + \beta_{\rho}  \cdot \text{diff}
$$

þar sem

$$
\text{diff} = |\text{off}_{i} + \text{def}_{i} - \text{off}_{j} - \text{def}_{j}|
$$

:::

![](images/football/fylgni_ita.png){width="100%" fig-align="center"}

## 

::: {.columns style="font-size:80%"}

Til að rifja upp

$$
\begin{gathered}
\log \mu_i = \mu_0 + \text{off}_{i} - \text{def}_{j} \qquad
\log \mu_j = \mu_0 + \text{off}_{j} - \text{def}_{i}
\end{gathered}
$$

Við metum $\mu_3$ sem

$$
\log\mu_3 = \log \rho + 0.5 \cdot (\log\mu_i + \log\mu_j)
$$

$$
\text{logit}(\rho) = \alpha_{\rho} + \beta_{\rho}  \cdot \text{diff}
$$

og stigafjöldi liðanna verður þá

$$
\begin{gathered}
X_1 = Z_1 + Z_3 \qquad
X_2 = Z_2 + Z_3
\end{gathered}
$$

$$
\begin{gathered}
Z_1 \sim \text{Poisson}(\mu_1) \qquad
Z_2 \sim \text{Poisson}(\mu_2) \qquad
Z_3 \sim \text{Poisson}(\mu_3) 
\end{gathered}
$$


:::

## 

::: {.columns style="font-size:60%"}

**Eru fleiri jafntefli en við ættum von á?**

$$
P(X_1 = x_1, X_2 = x_2) = \begin{cases}
p \cdot \text{Poisson}(x_1; \mu_{\text{jt}}) \cdot \mathbf{1}_{x_1 = x_2} + (1-p) \cdot \text{BivPoisson}(x_1, x_2; \mu_1, \mu_2, \mu_3) & \text{if } x_1 = x_2 \\
(1-p) \cdot \text{BivPoisson}(x_1, x_2; \mu_1, \mu_2, \mu_3) & \text{if } x_1 \neq x_2
\end{cases}
$$

$$
\text{logit}(p) = \alpha_p + \beta_p \cdot \text{diff}
$$

:::

## 

::: {.columns style="font-size:60%"}

**Eru fleiri jafntefli en við ættum von á?**

$$
P(X_1 = x_1, X_2 = x_2) = \begin{cases}
p \cdot \text{Poisson}(x_1; \mu_{\text{jt}}) \cdot \mathbf{1}_{x_1 = x_2} + (1-p) \cdot \text{BivPoisson}(x_1, x_2; \mu_1, \mu_2, \mu_3) & \text{if } x_1 = x_2 \\
(1-p) \cdot \text{BivPoisson}(x_1, x_2; \mu_1, \mu_2, \mu_3) & \text{if } x_1 \neq x_2
\end{cases}
$$

$$
\text{logit}(p) = \alpha_p + \beta_p \cdot \text{diff}
$$

:::

![](images/football/inflation.png){width="100%" fig-align="center"}

## 

::: {.columns style="font-size:60%"}

**Eru fleiri jafntefli en við ættum von á?**

$$
P(X_1 = x_1, X_2 = x_2) = \begin{cases}
p \cdot \text{Poisson}(x_1; \mu_{\text{jt}}) \cdot \mathbf{1}_{x_1 = x_2} + (1-p) \cdot \text{BivPoisson}(x_1, x_2; \mu_1, \mu_2, \mu_3) & \text{if } x_1 = x_2 \\
(1-p) \cdot \text{BivPoisson}(x_1, x_2; \mu_1, \mu_2, \mu_3) & \text{if } x_1 \neq x_2
\end{cases}
$$

$$
\text{logit}(p) = \alpha_p + \beta_p \cdot \text{diff}
$$

:::

![](images/football/inflation_ita.png){width="100%" fig-align="center"}


## 

::: {.columns style="font-size:80%"}

Til að rifja upp

$$
\begin{gathered}
\log \mu_i = \mu_0 + \text{off}_{i} - \text{def}_{j} \qquad
\log \mu_j = \mu_0 + \text{off}_{j} - \text{def}_{i}
\end{gathered}
$$

Við metum $\mu_3$ sem

$$
\log\mu_3 = \log \rho + 0.5 \cdot (\log\mu_i + \log\mu_j)
$$

$$
\text{logit}(\rho) = \alpha_{\rho} + \beta_{\rho}  \cdot \text{diff}
$$

::: {.column width="50%" style="font-size:80%"}

með líkum $p = \text{invlogit}(\alpha_p + \beta_p \cdot \text{diff})$

$$
X_1 \sim \text{Poisson}(\mu_{\text{jt}}) \qquad
X_2 \sim \text{Poisson}(\mu_{\text{jt}})
$$

$$
\mu_{\text{jt}} = \frac{\mu_1 + \mu_2}{2}
$$

:::

::: {.column width="50%" style="font-size:80%"}

með líkum $1 - p$

$$
\begin{gathered}
X_1 = Z_1 + Z_3 \qquad
X_2 = Z_2 + Z_3
\end{gathered}
$$

$$
\begin{gathered}
Z_1 \sim \text{Poisson}(\mu_1) \qquad
Z_2 \sim \text{Poisson}(\mu_2) \\
Z_3 \sim \text{Poisson}(\mu_3) 
\end{gathered}
$$

:::

:::

## 


::: {.r-stack}
![](images/football/next_week_preds.png){width="70%" fig-align="center" .fragment style="transform: rotate(-1deg)"}

![](images/football/deild_top.png){width="80%" fig-align="center" .fragment style="transform: rotate(7deg)"}

![](images/football/umspil_top.png){width="90%" fig-align="center" .fragment style="transform: rotate(-7deg)"}

![](images/football/styrkur.png){width="95%" fig-align="center" .fragment}

![](images/football/next_week_preds.png){width="80%" fig-align="center" .fragment}
:::

## {data-name="Veðmál"}

Við veðjum $S$ á veðmál með stuðulinn $o$

::: {.fragment}
$$
\text{R} = \begin{cases}
o \cdot S \quad &\text{ef } f(X_1, X_2) \in A \\
0  \qquad &\text{ef } f(X_1, X_2) \notin A
\end{cases}
$$
:::

::: {.fragment}
$$
G = R - S = \begin{cases}
(o - 1) \cdot S \quad &\text{ef } f(X_1, X_2) \in A \\
-S  \qquad &\text{ef } f(X_1, X_2) \notin A
\end{cases}
$$
:::

::: {.fragment}
Væntur gróði er
$$
\mathbb E[G] = p \cdot (o - 1) - (1 - p) = p \cdot o - 1 = (p - \pi) \cdot o
$$
:::

## 

::: {.r-stack}
![](images/football/bets_1x2.png){width="85%" fig-align="center" .fragment style="transform: rotate(-7deg)"}

![](images/football/bets_handicap.png){width="90%" fig-align="center" .fragment style="transform: rotate(7deg)"}

![](images/football/bets_totalgoals.png){width="95%" fig-align="center" .fragment}
:::

## 

**Kelly hlutfallið**


$$
f^* = \arg \max_{f} \mathbb E[\log (1 + f \cdot R)]
$$

![](images/kelly.png){width="60%" fig-align="center"}

##

**Kelly hlutfallið**

$$
f^* = \frac{p \cdot (o - 1) - (1 - p)}{o - 1} = \frac{po - 1}{o - 1} = \frac{\mathbb E[G]}{o - 1}
$$

![](images/kelly.png){width="60%" fig-align="center"}

##

$$
\max_{f_1, \ldots, f_n} \sum_{i=1}^n p_i \log(1 + f_i \cdot R_i)
$$

::: {.columns style="font-size:80%"}

::: {.column width="50%"}

* $\sum_{i=1}^n f_i \leq 1$
* $f_i \geq 0$

:::

::: {.column width="50%"}

![](images/kelly_algorithm.png){width="100%" fig-align="center"}

:::
:::

##

**Kelly brotahlutfall**

$$
f_{\text{raun}} = \alpha \cdot f^*_{\text{Kelly}}
$$


```{r}
#| eval: false
#| echo: true
kelly_frac <- 0.015 # 1.5% of optimal Kelly
kelly <- get_kelly(p, o)
kelly <- kelly * kelly_frac
bet_amount <- round(kelly * cur_pool, bet_digits)
```

![](images/football/bets_example.png){width="100%" fig-align="center"}

## {data-name="Niðurstöður"}

![](images/football/calibration_male.png){width="100%" fig-align="center"}

##

![](images/football/calibration_female.png){width="100%" fig-align="center"}

##

::: {.r-stack}
![](images/football/bets_overview.png){width="90%" fig-align="center" .fragment style="transform: rotate(-7deg)"}

![](images/football/football_bets.png){width="100%" fig-align="center" .fragment}
:::

##

::: {.r-stack}
![](images/handball/bets_overview.png){width="90%" fig-align="center" style="transform: rotate(-7deg)"}

![](images/handball/handball_bets.png){width="100%" fig-align="center" .fragment}
:::

## 

::: {.columns style="font-size:80%"}

$$
\begin{gathered}
\mu_i = \mu_0^t + \text{off}_{i} - \text{def}_{j} \qquad
\mu_j = \mu_0^t + \text{off}_{j} - \text{def}_{i}
\end{gathered}
$$

Í stað Poisson dreifingar kemur t-dreifingin

$$
\begin{pmatrix}
X_i \\
X_j
\end{pmatrix} \sim \text{student-t}\left(\begin{pmatrix}
\mu_i \\
\mu_j
\end{pmatrix}, \Sigma_{ij}, \nu\right)
$$

Samdreifnifylkið fer eftir keppandi liðum

$$
\Sigma_{ij} = \begin{pmatrix}
\sigma_i^2 & \rho \sigma_i \sigma_j \\
\rho \sigma_i \sigma_j & \sigma_j^2
\end{pmatrix}
$$


:::

![](images/handball/rho_nu.png){width="100%" fig-align="center"}

## 

::: {.columns style="font-size:80%"}

$$
\begin{gathered}
\mu_i = \mu_0^t + \text{off}_{i} - \text{def}_{j} \qquad
\mu_j = \mu_0^t + \text{off}_{j} - \text{def}_{i}
\end{gathered}
$$

Í stað Poisson dreifingar kemur t-dreifingin

$$
\begin{pmatrix}
X_i \\
X_j
\end{pmatrix} \sim \text{student-t}\left(\begin{pmatrix}
\mu_i \\
\mu_j
\end{pmatrix}, \Sigma_{ij}, \nu\right)
$$

Samdreifnifylkið fer eftir keppandi liðum

$$
\Sigma_{ij} = \begin{pmatrix}
\sigma_i^2 & \rho \sigma_i \sigma_j \\
\rho \sigma_i \sigma_j & \sigma_j^2
\end{pmatrix}
$$


:::

![](images/basketball/rho_nu.png){width="100%" fig-align="center"}

##

![](images/arbitrage1.png){width="40%" fig-align="center"}

![](images/arbitrage2.png){width="80%" fig-align="center"}

##

::: {.columns}
::: {.column width="50%"}
![](images/ruv_vidtal.png){width="100%" fig-align="center"}
:::
::: {.column width="50%"}
![](images/kosningavakt.png){width="100%" fig-align="center"}
:::
:::

## 

![](images/basketball/accuracy_home_away.png){width="100%" fig-align="center"}

##

::: {.columns}
::: {.column width="50%"}
![](images/basketball/group_table1.png){width="60%" fig-align="center"}
:::
::: {.column width="50%"}
![](images/basketball/group_table_true.png){width="89%" fig-align="center"}
:::
:::

## 

![](images/handball/three_teams.png){width="100%" fig-align="center"}

## {data-name="Umræður"}
::: {.columns style="font-size:80%"}

::: {.fragment}
* **Við getum notað tölfræði til að finna hagstæð veðmál í íþróttum**
:::

<br>

::: {.fragment}
* **Það er mikil óvissa og best að fara með þessi fræði eins og venjulegar fjárfestingar**
:::

<br>

::: {.fragment}
* **Þróa líkan eitt skref í einu, veðja fyrst mjög litlu**
:::

<br>

::: {.fragment}
* **Greiningar og myndrit geta verið vinsæl afurð**
:::

:::